<div ng-controller="resultsController" id="results" class="container" ng-show="tab === 'results'">
  <div id="results-table" class="col-sm-9">
    <div class="row">
      <div id="warning-alert" class="alert alert-warning col-md-10 col-md-offset-1 text-center" ng-show="warning">
        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> {{warning}}
      </div>
    </div>
    <h5 class="text-center">Search Returned {{results.length}} results</h5>
    <div class="row">
      <div class="col-sm-4"><h6 class="text-left">{{numSelected}} records selected.</h6></div>
      <h6 class="text-right"><i class="fa fa-info-circle" aria-hidden="true"></i> ZooPhy Jobs must contain 5 to 1000 Records</h6>
  </div>
  <div class="row form-group">
    <div class="col-sm-5">
      <div class="col-sm-3">
          <div class="dropdown">
              <button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown">Export
              <span class="caret"></span></button>
              <ul class="dropdown-menu">
                <li><a href="#" ng-click="setupDownload('csv');">CSV</a></li>
                <li><a href="#" ng-click="setupDownload('fasta');">FASTA</a></li>
              </ul>
              </div>
      </div>
      <div class="col-sm-3">
          <button type="button" class="btn btn-sm btn-default" data-toggle="modal" data-target="#fastaModel">Import FASTA </button>
      </div>
    </div>
    <div class="text-right">
        <button type="button" class="btn btn-sm btn-default" data-toggle="modal" data-target="#sampleSelectionModel">Random Sample</button>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-5">
        <h6 ng-show="generating"><i class="fa fa-hourglass-start" aria-hidden="true"></i> Generating Download... </h6>
        <a class="results-link" ng-show="downloadLink" ng-href="{{downloadLink}}" download="ZooPhyData.{{downloadFormat}}" target="_self"><i class="fa fa-download" aria-hidden="true"></i> Download File</a><span class="text-danger results-link" ng-show="downloadError"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> {{downloadError}}</span></h6>
    </div>
  </div>
    <table class="table table-striped table-hover table-condensed table-responsive">
    	<thead>
      	<tr>
          <th class="col-sm-1 text-center">ALL <input type="checkbox" ng-model="groupIsSelected" ng-click="toggleAll(); $event.stopPropagation();"></th>
        	<th class="col-sm-1" ng-click="updateSort('accession');"><i class="fa fa-sort" aria-hidden="true"></i>ID</th>
        	<th class="col-sm-1" ng-click="updateSort('genes');"><i class="fa fa-sort" aria-hidden="true"></i> Genes</th>
        	<th class="col-sm-2 hidden-xs" ng-click="updateSort('virus');"><i class="fa fa-sort" aria-hidden="true"></i> Virus</th>
        	<th class="col-sm-2" ng-click="updateSort('luceneDate');"><i class="fa fa-sort" aria-hidden="true"></i> Date</th>
        	<th class="col-sm-2 hidden-xs" ng-click="updateSort('host');"><i class="fa fa-sort" aria-hidden="true"></i> Host</th>
          <th class="col-sm-2" ng-click="updateSort('country');"><i class="fa fa-sort" aria-hidden="true"></i> Country</th>
          <th class="col-sm-1 hidden-xs" ng-click="updateSort('segmentLength');"><i class="fa fa-sort" aria-hidden="true"></i> Length</th>
      	</tr>
    	</thead>
    	<tbody>
      	<tr ng-class="(selectedRecord.accession === record.accession) ? 'selected' : ''" dir-paginate="record in results | orderBy:sortField:sortReverse | itemsPerPage:recordsPerPage" ng-click="LoadDetails(record);">
          <td class="col-sm-1 text-center" ng-click="toggleRecord(record); $event.stopPropagation();"><input type="checkbox" ng-checked="record.includeInJob" ng-click="toggleRecord(record); $event.stopPropagation();"></td>
          <td class="col-sm-1">{{record.accession}}</td>
      		<td class="col-sm-1">{{record.genes}}</td>
      		<td class="col-sm-2 hidden-xs">{{record.virus}}</td>
      		<td class="col-sm-2">{{record.date}}</td>
      		<td class="col-sm-2 hidden-xs">{{record.host}}</td>
          <td class="col-sm-2">{{record.country}}</td>
          <td class="col-sm-1 hidden-xs">{{record.segmentLength}}</td>
      	</tr>
    	</tbody>
      <tfoot>
			<tr>
        <td colspan="2">
          <div class="text-center">
            <label for="recordsPerPage">Records Per Page</label>
            <select id="recordsPerPage" class="form-control" ng-options="num as num for num in pageNums" ng-model="recordsPerPage">
              <!-- handled by Angular -->
            </select>
          </div>
        </td>
				<td colspan="4" class="text-center">
          <dir-pagination-controls max-size="5" direction-links="true" boundary-links="true" auto-hide="false"></dir-pagination-controls>
        </td>
        <td colspan="2">
          <div class="pushed-down">
            <input type="button" class="btn btn-info pull-right" ng-click="goToRun();" value="Configure ZooPhy Job" ng-disabled="numSelected < 5 || numSelected > 1000"/>
          </div>
        </td>
			</tr>
		</tfoot>
    </table>
  </div>
  <div id="detail-panel" class="col-sm-3 hidden-xs">
    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title text-center">Record Details: {{selectedRecord.accession}}</h3>
      </div>
      <div id="detailed-view" class="panel-body" ng-show="showDetails">
        <p><b>Date:</b> {{selectedRecord.date}}</p>
        <p><b>PubMed ID:</b> {{selectedRecord.pubmedID}}</p>
        <p><b>Virus:</b> {{selectedRecord.virus}}</p>
        <p><b>Taxon:</b> {{selectedRecord.taxon}}</p>
        <p><b>Strain:</b> {{selectedRecord.strain}}</p>
        <p><b>Isolate:</b> {{selectedRecord.isolate}}</p>
        <p><b>Host:</b> {{selectedRecord.host}}</p>
        <p><b>Location:</b> {{selectedRecord.location}}</p>
        <p><b>Genes:</b> {{selectedRecord.genes}}</p>
        <p><b>Definition:</b> {{selectedRecord.definition}}</p>
        <p class="text-center"><a ng-href="https://www.ncbi.nlm.nih.gov/nuccore/{{selectedRecord.accession}}" target="_new"><b>View Original Record</b></a></p>
      </div>
      <div id="detailed-view" class="panel-body" ng-show="showCustDetails">
        <p><b>Date:</b> {{selectedRecord.date}}</p>
        <p><b>Location:</b> {{selectedRecord.location}}</p>
        <p><b>Country:</b> {{selectedRecord.country}}</p>
        <p><b>Segment Length:</b> {{selectedRecord.segmentLength}}</p>
      </div>
    </div>
  </div>

<div class="modal fade" id="fastaModel" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <label ng-click="showFastaHelp();">
          <h4 class="modal-title">FASTA
            <span class="help-info" data-toggle="tooltip" data-placement="top" 
            title="The .FASTA file needs to be a new line delimited .txt file. The current search limit is 2500 sequences.
            Please structure your definition lines as such:
            >[ID]|[GeonamesIDorName]|[Time]
            Where ID = Some unique ID
            GeonamesID = the unique geonames.org ID of your location or location name
            Time = the decimal day or year of your sample or date in format DD-mmm-YYYY e.g. 08-Oct-2011
            
            For example:
            >1|5308655|2006.23
            ATGGAGAAAATAGTGC...
            >2|5317058|2008.01
            ATGGAGAAAATAGTGC..."> <i class="fa fa-question-circle" aria-hidden="true"></i></span>
          </h4></label>
        </div>
        <div class="modal-body">
          <div class="container">
            <div class="row form-group">
                Select a file  
                <label class="btn btn-default btn-file btn-sm">Select<input id="data-upload" type="file" onchange="angular.element(this).scope().uploadFasta(this.files);this.value=null"></input></label>
                <p style="display:inline" class="text-muted">&nbsp;{{fastaFilename}}</p>
                <span class="text-danger results-link" ng-show="fastaError"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> {{fastaError}}</span>
            </div>
            <div class="row" >
                <label class="checkbox-inline"><input type="checkbox" ng-disabled="results.length === 0" ng-model="combineResults"/>
                <p style="display:inline" class="text-muted" ng-show="results.length === 0" >Combined with searched accession</p>
                <p style="display:inline" ng-show="results.length !== 0">Combined with searched accession</p>
              </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" ng-click="sendFasta();" ng-disabled="fastaFile === null || fastaFile === undefined" data-dismiss="modal">Upload</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="sampleSelectionModel" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Select Random Downsample<span class="help-info" data-toggle="tooltip" data-placement="top" 
            title="Select random records for job"> <i class="fa fa-question-circle" aria-hidden="true"></i></span>
          </div>
        </h4>
          <div class="modal-body">
            <div class="container">
              <div class="row form-group">
                <input type="radio" name="sampleTypeNumber" id="number" ng-model="sampleType" value="number"/> Number&nbsp;&nbsp;
                <input type="radio" name="sampleTypePercent" id="percent" ng-model="sampleType" value="percent" ng-checked="true"/> Percentage                      </div>
                  <div class="row">
                    {{sampleType}} of records
                    <input class="form-control sampleBox" type="number" min="0" name="sampleAmount" ng-change="updatePercentOfRecords();" ng-model="sampleAmount"/>
                    <p style="display:inline" class="text-muted" ng-show="sampleType === 'percent'" >&nbsp;{{percentOfRecords}} records</p>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" ng-click="validateDownSample();" data-dismiss="modal">Done</button>
          </div>
        </div>
      </div>
    </div>
</div>
